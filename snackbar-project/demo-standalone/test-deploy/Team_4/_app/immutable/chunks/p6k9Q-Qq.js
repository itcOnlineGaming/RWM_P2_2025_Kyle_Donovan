const i="http://localhost:3000",a="BB0mh7LqN9ykwQ6JehCD58ogN9Lphh3LVJ7QaFm6iUZJh5Hr_FfXt9ey4OOyU-BuJblIu2v2ycVShK7WSoy46vE";function c(e){const t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(r),n=new Uint8Array(o.length);for(let s=0;s<o.length;++s)n[s]=o.charCodeAt(s);return n}async function u(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("Push notifications not supported"),!1;try{console.log("Starting push notification subscription...");const e=await Promise.race([navigator.serviceWorker.ready,new Promise((o,n)=>setTimeout(()=>n(new Error("Service worker timeout")),1e4))]);console.log("Service worker ready:",e);let t=await e.pushManager.getSubscription();t?console.log("Using existing subscription:",t):(console.log("No existing subscription, creating new one..."),t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:c(a)}),console.log("New subscription created:",t)),console.log("Sending subscription to server...");const r=await fetch(`${i}/subscribe`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"},mode:"cors"});if(r.ok){console.log("âœ… Subscribed to push notifications");const o=await r.json();return console.log("Server response:",o),!0}else{console.error("Server response status:",r.status,r.statusText);const o=await r.text();return console.error("Error details:",o),!1}}catch(e){return console.error("Push subscription error:",e),console.error("Error details:",e instanceof Error?e.message:String(e)),!1}}async function l(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return!1;try{return await(await navigator.serviceWorker.ready).pushManager.getSubscription()!==null}catch{return!1}}async function g(e,t,r){try{const o={title:e,body:t,icon:r?.icon||"ðŸ“…",badge:r?.badge||"ðŸ“…",tag:r?.tag||"notification",requireInteraction:r?.requireInteraction||!1};return(await fetch(`${i}/notify`,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})).ok}catch(o){return console.error("Failed to trigger push notification:",o),!1}}export{l as i,u as s,g as t};
